<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css" integrity="sha512-EZLkOqwILORob+p0BXZc+Vm3RgJBOe1Iq/0fiI7r/wJgzOFZMlsqTa29UEl6v6U6gsV4uIpsNZoV32YZqrCRCQ==" crossorigin="anonymous" referrerpolicy="no-referrer" /> -->
    <script src="modal.js"></script>
    <!-- <script src="submit.js"></script>  -->

    
    <title>Reset</title>
    
</head>
<body>

    <p> Reset password for <%= email %> </p>

    <ul>
        <% if(messages.success_msg) { %>
            <li><%= messages.success_msg %></li>
        <% } %>
        
    </ul>

    <ul>    
        <% if(messages.error){ %>
            <li><%= messages.error %></li>
        <% } %>
    </ul>

    <!-- Removed form action and method attributes, added an id to the form for easier selection -->
    <form id="loginForm">
        <div>
            <input type="password" name="password" id ="password" placeholder="password" required>
        </div>
        <div>
            <input type="password" name="password2" id ="password2" placeholder="confirm password" required>
        </div> 

        <div>
            <!-- Changed input type to button and added an onclick attribute -->
            <input type="button" value="Reset Password" id="resetPasswordButton">
        </div>
    </form>
        <a href="#" onclick="updateModalContent('/modals/register')">Register</a>
        <a href="#" onclick="updateModalContent('/modals/home')">Home</a>
        <a href="#" onclick="updateModalContent('/modals/login')">Login</a>

<script>
async function updatePassword() {
    const form = document.getElementById('loginForm');
    const password = form.password.value;
    const password2 = form.password2.value;

    const data = new URLSearchParams();
    data.append('password', password);
    data.append('password2', password2);

    try {
        const response = await fetch('', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: data, 
        });

        // Check if the response is a redirect
        if (response.redirected) {
            // Follow the redirect
            window.location.href = response.url;
        } else {
            // Handle other types of responses (e.g., errors)
            const message = await response.json();
            console.log(message);
        }
    } catch (error) {
        console.error('Error submitting form:', error);
    }
};

</script>

</body>
</html>
